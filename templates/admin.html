<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ç®¡ç†è€…ãƒšãƒ¼ã‚¸</title>
  <style>
    body {
      font-family: "Segoe UI", "Noto Sans JP", sans-serif;
      padding: 20px;
      background: linear-gradient(180deg, #e3f2fd 0%, #bbdefb 50%, #b3e5fc 100%);
      color: #0d47a1;
    }
    h1, h2 { color: #0d47a1; text-shadow: 0 1px 0 rgba(255,255,255,0.8); }
    .section {
      background: rgba(255, 255, 255, 0.88);
      backdrop-filter: blur(6px);
      padding: 18px;
      border-radius: 12px;
      box-shadow: 0 3px 8px rgba(0, 0, 50, 0.1);
      margin-bottom: 30px;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { border: 1px solid #b3e5fc; padding: 8px; text-align: left; background: #fff; }
    th { background: #81d4fa; color: #01579b; }
    textarea { width: 100%; min-height: 60px; border: 1px solid #81d4fa; border-radius: 6px; padding: 6px; }
    button {
      padding: 6px 14px; border-radius: 6px; border: none;
      background: linear-gradient(135deg, #4fc3f7, #0288d1); color: #fff; cursor: pointer;
    }
    button:hover { background: linear-gradient(135deg, #81d4fa, #0277bd); }
    details {
      background: #e1f5fe; border-left: 5px solid #4fc3f7; border-radius: 8px; padding: 10px 12px; margin-top: 12px;
    }
    summary { cursor: pointer; font-weight: 700; color: #01579b; }
    .logout { float: right; background: linear-gradient(135deg, #81d4fa, #4fc3f7); }
    .logout:hover { background: linear-gradient(135deg, #4fc3f7, #01579b); }
  </style>
</head>
<body>
  <h1>ğŸŒŠ ç®¡ç†è€…ãƒšãƒ¼ã‚¸</h1>
  <a href="{{ url_for('logout') }}"><button class="logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button></a>

  <!-- ç›´è¿‘ã®ç‚¹å‘¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ -->
  <div class="section">
    <h2>ğŸ“‹ ç‚¹å‘¼ï¼ˆç›´è¿‘ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰</h2>
    <p>é–‹å§‹: {{ latest.started_at }}</p>
    <form action="{{ url_for('attendance_reset') }}" method="post">
      <button type="submit">æ–°ã—ã„ç‚¹å‘¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ï¼ˆãƒªã‚»ãƒƒãƒˆï¼‰</button>
    </form>

    <table>
      <tr><th>æ™‚åˆ»</th><th>ç­ç•ªå·</th></tr>
      {% if latest.entries %}
        {% for e in latest.entries %}
        <tr>
          <td>{{ e.time }}</td>
          <td>{{ e.team }}</td>
        </tr>
        {% endfor %}
      {% else %}
        <tr><td colspan="2">ã¾ã ç‚¹å‘¼ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>
      {% endif %}
    </table>
  </div>

  <!-- éå»ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ -->
  <div class="section">
    <h2>ğŸ•“ éå»ã®ç‚¹å‘¼ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´</h2>
    {% if attendance.sessions|length > 1 %}
      {% for ses in attendance.sessions[:-1] %}
      <details>
        <summary>é–‹å§‹: {{ ses.started_at }}ï¼ˆ{{ ses.entries|length }} ä»¶ï¼‰</summary>
        <table>
          <tr><th>æ™‚åˆ»</th><th>ç­ç•ªå·</th></tr>
          {% if ses.entries %}
            {% for e in ses.entries %}
            <tr>
              <td>{{ e.time }}</td>
              <td>{{ e.team }}</td>
            </tr>
            {% endfor %}
          {% else %}
            <tr><td colspan="2">è¨˜éŒ²ãªã—</td></tr>
          {% endif %}
        </table>
      </details>
      {% endfor %}
    {% else %}
      <p>å±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endif %}
  </div>

  <!-- ä»Šæ—¥ãƒ»æ˜æ—¥ã®äºˆå®šï¼ˆç­ç•ªå·é †ï¼‰ -->
  {% for day in ["today", "tomorrow"] %}
  <div class="section">
    <h2>ğŸ—“ {{ "ä»Šæ—¥" if day=="today" else "æ˜æ—¥" }}ã®äºˆå®šï¼ˆç­ç•ªå·é †ï¼‰</h2>
    {% set posts_day = data[day] %}
    {% if posts_day %}
      {% set teams = posts_day | map(attribute='author') | list | unique | sort %}
      {% for team in teams %}
        <details>
          <summary>ç­ {{ team }}</summary>
          <table>
            <tr><th>é–‹å§‹</th><th>å†…å®¹</th><th>ç®¡ç†è€…ã‚³ãƒ¡ãƒ³ãƒˆ</th></tr>
            {% for post in posts_day %}
              {% if post.author == team %}
              <tr>
                <td>{{ post.start }}</td>
                <td>{{ post.task }}</td>
                <td>
                  <form action="{{ url_for('admin_comment', day=day, index=loop.index0) }}" method="post">
                    <textarea name="comment">{{ post.comment }}</textarea>
                    <button type="submit">ä¿å­˜</button>
                  </form>
                </td>
              </tr>
              {% endif %}
            {% endfor %}
          </table>
        </details>
      {% endfor %}
    {% else %}
      <p>ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endif %}
  </div>
  {% endfor %}

  <div class="section">
    <a href="{{ url_for('dashboard') }}">ğŸ”™ ç­ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
  </div>
</body>
</html>
